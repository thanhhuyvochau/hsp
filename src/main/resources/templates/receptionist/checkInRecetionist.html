<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lễ tân</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css"/>

    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    <script src="https://kit.fontawesome.com/ae360af17e.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="/assets/css/manager.css"/>
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <script src="/assets/js/sidebar.js"></script>
    <script src="/assets/js/manager.js"></script>
    <link rel="stylesheet" href="/assets/css/header-footer.css">
    <link rel="stylesheet" href="/assets/css/header_footer_style.css">

    <!-- Include Bootstrap-datepicker CSS -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">

    <!-- Include Bootstrap-datepicker JS -->
    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <!-- Include Bootstrap-datepicker localization for Vietnamese -->
    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.vi.min.js"></script>

    <style>
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(21, 20, 20, 0.7);
            justify-content: center;
            align-items: center;
            color: black;
        }

        .overlay h1 {
            text-align: center;
        }

        .overlay__content {
            width: 70%;
            position: sticky;
            top: 25%;
            /*box-shadow: 10px 10px 5px 0px rgba(0, 0, 0, 0.75);*/
            max-height: 500px;
        }

        .button-container {
            gap: 2rem;
            display: flex;
            justify-content: flex-end;
        }

        .button-container button {
            font-size: 14px;
            cursor: pointer;
            width: 120px;
            appearance: none;
            background-color: #2ea44f;
            border: 1px solid rgba(27, 31, 35, .15);
            border-radius: 6px;
            box-shadow: rgba(27, 31, 35, .1) 0 1px 0;
            box-sizing: border-box;
            color: #fff;
            display: inline-block;
            font-family: -apple-system, system-ui, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            font-weight: 600;
            line-height: 20px;
            padding: 6px 14px;
            position: relative;
            text-align: center;
            text-decoration: none;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            vertical-align: middle;
            white-space: nowrap;
        }

        .button-container button:focus:not(:focus-visible):not(.focus-visible) {
            box-shadow: none;
            outline: none;
        }

        .button-container button:hover {
            background-color: #2c974b;
        }

        .button-container button:focus {
            box-shadow: rgba(46, 164, 79, .4) 0 0 0 3px;
            outline: none;
        }

        .button-container button:disabled {
            background-color: #94d3a2;
            border-color: rgba(27, 31, 35, .1);
            color: rgba(255, 255, 255, .8);
            cursor: default;
        }

        .button-container button:active {
            background-color: #298e46;
            box-shadow: rgba(20, 70, 32, .2) 0 1px 0 inset;
        }
    </style>
</head>

<body>

<!--	<body data-bs-target=".navbar" data-bs-offset="100"></body>-->
<form id="checkinForm" th:action="@{/receptionist/new-checkIn}" method="post" th:object="${saveCheckinDTO}" class="wrapper">
    <!-- Sidebar Holder -->
    <nav id="sidebar">
        <div class="sidebar-header border-bottom">
            <img src="/assets/img/Orilogo.png" class="img-fluid">
        </div>

        <ul class="list-unstyled components border-bottom">
            <p class="border-bottom fw-bold"><i class="bi bi-person-badge-fill pe-2"></i>Lễ tân</p>
            <li>
                <a href="#"><i class="fa-regular fa-rectangle-list pe-2"></i>Danh sách phòng</a>
            </li>
            <li>
                <a href="./createRoomReceptionist"><i class="fa-solid fa-check-double pe-2"></i>Đặt phòng</a>
            </li>
            <li>
                <a href="./checkOutReceptionist"><i class="fa-solid fa-right-from-bracket pe-2"></i>Trả phòng</a>
            </li>
            <li>
                <a href="./listRoomInUse"><i class="fa-solid fa-house-user pe-2"></i>Phòng đang sử dụng</a>
            </li>
            <li>
                <a href="./listBookingReceptionist"><i class="fa-solid fa-bell pe-2"></i>Đặt trước</a>
            </li>
            <li>
                <a href="./listHistoryBooking"><i class="fa-solid fa-clipboard pe-2"></i>Lịch sử đặt phòng</a>
            </li>
        </ul>

    </nav>

    <!-- Page Content Holder -->
    <div id="content">

        <nav class="navbar navbar-expand-lg shadow ">
            <div class="container-fluid">

                <button type="button" id="sidebarCollapse" class="navbar-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-align-justify"></i>
                </button>


                <button class=" btn bi-person-circle " style="font-size: 2em;"></button>
            </div>
        </nav>
        <main class="content px-3 py-2">
            <div class="container">
                <div class="row mt-3">
                    <h3 class="fw-bold text-center">Check-in</h3>
                    <hr>
                    <div class="row">
                        <h4 class="fw-bold">Khách hàng:</h4>
                    </div>
                    <div class="row ms-2 mb-3 border shadow">
                        <div class="col-lg-8">
                            <div class="row me-5">
                                <div class="col ms-2 mt-2">
                                    <h6 class="fw-bold">Họ tên: <a th:text="${viewCheckInDTO.getName()}"></a></h6>
                                </div>
                            </div>
                            <div class="row mt-2 me-5">
                                <div class="col  ms-2">
                                    <h6 class="fw-bold">Số điện thoại: <a th:text="${viewCheckInDTO.getPhone()}"></a>
                                    </h6>
                                </div>
                            </div>
                            <div class="row mt-2 me-5">
                                <div class="col  ms-2">
                                    <h6 class="fw-bold">Địa chỉ: <a th:text="${viewCheckInDTO.getAddress()}"></a></h6>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 ">
                            <div class="row me-5 mt-2">
                                <h6 class="fw-bold">Email: <a th:text="${viewCheckInDTO.getEmail()}"></a></h6>
                            </div>
                            <div class="row mt-2 me-5">
                                <h6 class="fw-bold">Ghi chú: <a th:text="${viewCheckInDTO.getNote()}"></a></h6>
                            </div>
                            <div class="row mt-2 me-5">
                                <h6 class="fw-bold">Phương thức đặt: <a th:text="${viewCheckInDTO.paymentTypeName}"></a></h6>
                            </div>
                        </div>
                    </div>
                    <h4 class="fw-bold mt-3">Thông tin phòng & dịch vụ:</h4>
                    <h6 class=" ms-2 mt-2">Mã đặt phòng: <a th:text="${viewCheckInDTO.getHotelBookingId()}"></a>
                    </h6>
                </div>
                <div class="row mt-3 ms-1 me-3 border shadow">
                    <div class="col-lg-6 mt-3">
                        <p class="fw-bold">Ngày nhận phòng: <a th:text="${viewCheckInDTO.getCheckIn()}"></a></p>
                        <p class="fw-bold">Ngày nhận phòng thực tế: <a th:text="${viewCheckInDTO.getCheckInBooking()}"></a>
                        </p>
                    </div>
                    <div class="col-lg-6 mt-3">
                        <p class="fw-bold text-end">Ngày trả phòng đã đặt: <a th:text="${viewCheckInDTO.getCheckOut()}"></a>
                        </p>

                    </div>
                </div>

                <div class="row mt-5 me-1">
                    <div class="d-flex flex-column">
                        <table class="table table-striped table-hover border align-baseline text-center shadow">
                            <thead class="table-dark">
                            <tr>
                                <th scope="col">STT</th>
                                <th scope="col">Loại phòng</th>
                                <th scope="col">Số phòng đặt</th>
                                <th scope="col">Chọn phòng</th>
                                <th scope="col">Ưu đãi</th>
                                <th scope="col">Chi tiết</th>
                                <th scope="col">Giá phòng</th>
                                <th scope="col">Tổng giá</th>
                                <th scope="col"></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="bookDetail, iStat : ${viewCheckInDTO.getBookingDetails()}">
                                <th scope="row" th:text="${iStat.index + 1}"></th>
                                <td th:text="${bookDetail.getCategoryName()}"></td>
                                <td th:text="${bookDetail.getRoomName()}"></td>
                                <td><select onchange="handleChangeRoom(this)" th:data-booking-detail="${bookDetail.getBookingDetailId()}" class="form-select">
                                    <option th:selected="${bookDetail.getRoomId() == room.getRoomId()}" th:value="${room.getRoomId()}" th:text="${room.getRoomName()}" th:each="room,iterStat  : ${bookDetail.getOptionRooms()}">101</option>
                                </select></td>
                                <td>Bữa sáng</td>
                                <td>Không</td>
                                <td th:text="${#numbers.formatDecimal(bookDetail.getPrice(), 0, 'COMMA', 0, 'POINT')}"></td>
                                <td th:text="${#numbers.formatDecimal(bookDetail.getTotalPrice(), 0, 'COMMA', 0, 'POINT')}"></td>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="row mt-4 me-2">
                    <div class="row ms-1">
                        <h4 class="fw-bold">Thanh toán:</h4>
                    </div>
                    <div class="row ms-1">
                        <div class="col-lg-12 border shadow">
                            <div class="row me-4 mt-2">
                                <div class="col ms-4">
                                    <h6 class="fw-bold">Giá phòng:</h6>
                                </div>
                                <div class="col text-end"><a id="room-price"
                                                             th:text="${#numbers.formatDecimal(viewCheckInDTO.getTotalRoomPrice(), 0, 'COMMA', 0, 'POINT')}"></a></div>
                            </div>
                            <div class="row me-4">
                                <div class="col ms-4">
                                    <h6 class="fw-bold">Thuế(10%):</h6>
                                </div>
                                <div class="col text-end"><a th:text="${#numbers.formatDecimal(viewCheckInDTO.getTaxPrice(), 0, 'COMMA', 0, 'POINT')} " id="tax-price"></a></div>
                            </div>
                            <div class="row mt-2 me-4">
                                <div class="col ms-4">
                                    <h6 class="fw-bold">Tổng giá:</h6>
                                </div>
                                <div class="col text-end"><a id="total-price" th:text="${#numbers.formatDecimal(viewCheckInDTO.getTotalPriceOfBooking(), 0, 'COMMA', 0, 'POINT')}"></a></div>
                            </div>
                            <div class="row mt-2 me-4">
                                <div class="col ms-4">
                                    <h6 class="fw-bold">Đặt cọc (50%):</h6>
                                </div>
                                <div class="col text-end"><a id="deposit-price"
                                                             th:text="${#numbers.formatDecimal(viewCheckInDTO.getPrepay(), 0, 'COMMA', 0, 'POINT')}"></a></div>
                            </div>
                            <div class="row mt-2 me-4">
                                <div class="col ms-4">
                                    <h6 class="fw-bold">Đã thanh toán:</h6>
                                </div>
                                <div class="col text-end"><a id="prepay-price"
                                                             th:text="${#numbers.formatDecimal(viewCheckInDTO.getPrepay(), 0, 'COMMA', 0, 'POINT')}"></a></div>
                                <input type="hidden" th:value="${viewCheckInDTO.getPrepay()}" id="prepay-price-hidden"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-5">
                    <div class="btn-end text-center">
                        <!-- Sử dụng lớp 'text-center' để căn giữa nút -->
                        <button type="button" class="btn btn-secondary"
                                style="margin-right: 2rem; margin-top: 2rem; margin-bottom: 2rem;"><a th:href="@{/receptionist/listRoomInUse}">Quay
                            lại</a>
                        </button>
                        <button type="button" onclick="checkInConfirm()" class="btn btn-dark" style="margin-right: 2rem; margin-top:
                                2rem;margin-bottom: 2rem;">Check-in
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <input type="hidden" th:value="${saveCheckinDTO.getHotelBookingId()}" name="hotelBookingId" id="hotelBookingId">
    <div  th:each="bookingDetail,iterStat  : ${saveCheckinDTO.getSaveCheckinDetailDTOS()}" class="booking-detail-input-container">

        <input class="roomInputId" th:id="'roomInputID-'+${bookingDetail.getBookingRoomId()}" th:value="${bookingDetail.getRoomID()}" type="hidden"
               th:field="*{saveCheckinDetailDTOS[__${iterStat.index}__].roomID}">

        <input th:id="'bookingDetailID-'+${bookingDetail.getBookingRoomId()}"  th:value="${bookingDetail.getBookingRoomId()}" type="hidden"
               th:field="*{saveCheckinDetailDTOS[__${iterStat.index}__].bookingRoomId}">
    </div>
</form>


</body>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
<script src="https://kit.fontawesome.com/032d11eac3.js" crossorigin="anonymous"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    let services = [[${roomServices}]];
    let bookingData = [[${saveCheckinDTO}]]
    let errorMessage = [[${errorMessage}]]
    /*]]>*/
    if (errorMessage){
        alert(errorMessage);
    }
    $(document).ready(function () {
        // Initialize DataTable
        $("#openButton").click(function () {
            console.log(services);
            $("#overlay").css("display", "flex");
        });

        $("#confirm-overlay-btn").click(function () {
            pattern = "[1-9]\d*|0\.\d+"
            $("#overlay").css("display", "none");
        });
        $("#close-overlay-btn").click(function () {
            $("#overlay").css("display", "none");
        });

        $(".modal-content").click(function (e) {
            e.stopPropagation(); // Prevent modal close on modal content click
        });

        $("#surcharge-price").change(function (e) {
            calculatePrices();
        });

        $('#surcharge-price').on('input', function () {
            var inputValue = $(this).val();
            // Use a regular expression to allow only positive numbers
            var isValid = /^\d*\.?\d+$/.test(inputValue);

            if (!isValid) {
                // If the input is not a valid number, clear the input field
                $(this).val('');
            }
        });
    });
    function checkInConfirm() {
        let text = "Bạn có muốn đổi trạng thái đặt này thành 'đã check-in'";
        let $checkinForm = $("#checkinForm");
        if (confirm(text) === true) {
            $checkinForm.trigger( "submit" );
        }
    }
    function handleChangeRoom(roomChangeElement){
        let roomId = roomChangeElement.value;
        let bookingDetailId = $(roomChangeElement).attr("data-booking-detail");
        if (isDuplicateRoom(roomId)){
            document.getElementById("roomInputID-"+bookingDetailId).value = roomId;
        }else{
            alert("Phòng này đã được chọn vui lòng chọn phòng khác");
            roomChangeElement.value = document.getElementById("roomInputID-"+bookingDetailId).value;
        }

    }
    function isDuplicateRoom(roomId){
        let roomInputId = document.getElementsByClassName('roomInputId');
        console.log(roomInputId);
        for (let i = 0; i < roomInputId.length; i++) {
            let roomInput = roomInputId[i];
            if (Number(roomInput.value) === Number(roomId)){
                return false;
            }
        }
        return true
    }
</script>
</html>